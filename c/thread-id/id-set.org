#+Title: id-set
考虑给每个活跃的线程分配一个id，任意时刻不能有两个线程具有同样的id，
在满足这个约束的条件小，分配的id原则上应该选择最小的可用整数。

用bitmap来记录id的使用情况是个比较好的办法，但是为了加快查找空闲位的速度，
应该给bitmap加上索引，如果同时活跃的线程数不多，用一级索引就够了。

在64位机器上，用一个 =uint64_t= 记录索引，用一个长度为64的 =uint64_t= 数组记录bitmap。
索引的含义是: 如果数组中某个 =uint64_t= 有空位，索引中对应的一位置1，否则置0。
查找空位分两步: 通过索引可以快速找到第一个有空位的 =uint64_t=, 然后再在数组中对应的 =uint64_t= 整数中查找第一个空位。

gcc有built-in函数，可以在 =uint64_t= 中找到第一个为1的位：
#+begin_example
#define first_1bit(x) ((int64_t)__builtin_ffsll(x) - 1)
#+end_example

